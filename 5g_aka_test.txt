(herald "5G AKA Round 1 suci "
  (comment "First attempt for modeling 5G AKA"))

(comment "CPSA 3.6.6")
(comment "All input read from 5g_aka_test.scm")

(defprotocol AKA5G basic
  (defrole UserEquip
    (vars (SUPI RAND data) (UE SN HN name) (SQN text))
    (trace (send (enc SUPI (pubk HN)))
      (recv
        (cat RAND (hash SQN (hash (ltk UE HN) RAND))
          (hash SQN RAND (ltk UE HN))))
      (send
        (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN
          RAND (hash (ltk UE HN) RAND))))
    (non-orig (ltk UE HN)))
  (defrole ServingNetwork
    (vars (SUPI RAND data) (UE SN HN name) (SQN text))
    (trace (recv (enc SUPI (pubk HN))) (send (enc SUPI (pubk HN) SN))
      (recv
        (cat RAND
          (cat (hash SQN (hash (ltk UE HN) RAND))
            (hash SQN RAND (ltk UE HN)))
          (hash
            (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND))
              SN RAND (hash (ltk UE HN) RAND)) RAND)))
      (init
        (hash
          (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN
            RAND (hash (ltk UE HN) RAND)) RAND))
      (send
        (cat RAND (hash SQN (hash (ltk UE HN) RAND))
          (hash SQN RAND (ltk UE HN))))
      (recv
        (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN
          RAND (hash (ltk UE HN) RAND)))
      (send
        (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN
          RAND (hash (ltk UE HN) RAND)))
      (recv
        (cat "Success"
          (hash
            (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND))
              SN (hash SQN (hash (ltk UE HN) RAND))) SN) SUPI)))
    (non-orig SQN (ltk UE HN)))
  (defrole HomeNetwork
    (vars (SUPI RAND data) (UE SN HN name) (SQN text))
    (trace (recv (enc SUPI (pubk HN) SN))
      (init
        (cat
          (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN
            RAND (hash (ltk UE HN) RAND)) SUPI))
      (send
        (cat RAND
          (cat (hash SQN (hash (ltk UE HN) RAND))
            (hash SQN RAND (ltk UE HN)))
          (hash
            (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND))
              SN RAND (hash (ltk UE HN) RAND)) RAND)))
      (recv
        (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN
          RAND (hash (ltk UE HN) RAND)))
      (send
        (cat "Success"
          (hash
            (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND))
              SN (hash SQN (hash (ltk UE HN) RAND))) SN) SUPI)))
    (non-orig SQN (ltk UE HN))
    (uniq-gen RAND)))

(defskeleton AKA5G
  (vars (SQN text) (SUPI RAND data) (UE HN SN name))
  (defstrand UserEquip 3 (SQN SQN) (SUPI SUPI) (RAND RAND) (UE UE)
    (SN SN) (HN HN))
  (non-orig (ltk UE HN))
  (traces
    ((send (enc SUPI (pubk HN)))
      (recv
        (cat RAND (hash SQN (hash (ltk UE HN) RAND))
          (hash SQN RAND (ltk UE HN))))
      (send
        (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN
          RAND (hash (ltk UE HN) RAND)))))
  (label 0)
  (unrealized (0 1))
  (origs)
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton AKA5G
  (vars (SQN text) (SUPI RAND SUPI-0 data) (UE HN SN SN-0 name))
  (defstrand UserEquip 3 (SQN SQN) (SUPI SUPI) (RAND RAND) (UE UE)
    (SN SN) (HN HN))
  (defstrand HomeNetwork 3 (SQN SQN) (SUPI SUPI-0) (RAND RAND) (UE UE)
    (SN SN-0) (HN HN))
  (precedes ((1 2) (0 1)))
  (non-orig SQN (ltk UE HN))
  (uniq-gen RAND)
  (operation encryption-test (added-strand HomeNetwork 3)
    (hash SQN (hash (ltk UE HN) RAND)) (0 1))
  (traces
    ((send (enc SUPI (pubk HN)))
      (recv
        (cat RAND (hash SQN (hash (ltk UE HN) RAND))
          (hash SQN RAND (ltk UE HN))))
      (send
        (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN
          RAND (hash (ltk UE HN) RAND))))
    ((recv (enc SUPI-0 (pubk HN) SN-0))
      (init
        (cat
          (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND))
            SN-0 RAND (hash (ltk UE HN) RAND)) SUPI-0))
      (send
        (cat RAND
          (cat (hash SQN (hash (ltk UE HN) RAND))
            (hash SQN RAND (ltk UE HN)))
          (hash
            (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND))
              SN-0 RAND (hash (ltk UE HN) RAND)) RAND)))))
  (label 1)
  (parent 0)
  (unrealized)
  (shape)
  (maps
    ((0) ((SUPI SUPI) (UE UE) (HN HN) (SQN SQN) (RAND RAND) (SN SN))))
  (origs))

(defskeleton AKA5G
  (vars (SQN text) (SUPI RAND data) (UE HN SN name))
  (defstrand UserEquip 3 (SQN SQN) (SUPI SUPI) (RAND RAND) (UE UE)
    (SN SN) (HN HN))
  (deflistener (cat SQN (hash (ltk UE HN) RAND)))
  (precedes ((1 1) (0 1)))
  (non-orig (ltk UE HN))
  (operation encryption-test
    (added-listener (cat SQN (hash (ltk UE HN) RAND)))
    (hash SQN (hash (ltk UE HN) RAND)) (0 1))
  (traces
    ((send (enc SUPI (pubk HN)))
      (recv
        (cat RAND (hash SQN (hash (ltk UE HN) RAND))
          (hash SQN RAND (ltk UE HN))))
      (send
        (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN
          RAND (hash (ltk UE HN) RAND))))
    ((recv (cat SQN (hash (ltk UE HN) RAND)))
      (send (cat SQN (hash (ltk UE HN) RAND)))))
  (label 2)
  (parent 0)
  (unrealized (0 1) (1 0))
  (dead)
  (comment "empty cohort"))

(comment "Nothing left to do")

(defprotocol AKA5G basic
  (defrole UserEquip
    (vars (SUPI RAND data) (UE SN HN name) (SQN text))
    (trace (send (enc SUPI (pubk HN)))
      (recv
        (cat RAND (hash SQN (hash (ltk UE HN) RAND))
          (hash SQN RAND (ltk UE HN))))
      (send
        (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN
          RAND (hash (ltk UE HN) RAND))))
    (non-orig (ltk UE HN)))
  (defrole ServingNetwork
    (vars (SUPI RAND data) (UE SN HN name) (SQN text))
    (trace (recv (enc SUPI (pubk HN))) (send (enc SUPI (pubk HN) SN))
      (recv
        (cat RAND
          (cat (hash SQN (hash (ltk UE HN) RAND))
            (hash SQN RAND (ltk UE HN)))
          (hash
            (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND))
              SN RAND (hash (ltk UE HN) RAND)) RAND)))
      (init
        (hash
          (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN
            RAND (hash (ltk UE HN) RAND)) RAND))
      (send
        (cat RAND (hash SQN (hash (ltk UE HN) RAND))
          (hash SQN RAND (ltk UE HN))))
      (recv
        (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN
          RAND (hash (ltk UE HN) RAND)))
      (send
        (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN
          RAND (hash (ltk UE HN) RAND)))
      (recv
        (cat "Success"
          (hash
            (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND))
              SN (hash SQN (hash (ltk UE HN) RAND))) SN) SUPI)))
    (non-orig SQN (ltk UE HN)))
  (defrole HomeNetwork
    (vars (SUPI RAND data) (UE SN HN name) (SQN text))
    (trace (recv (enc SUPI (pubk HN) SN))
      (init
        (cat
          (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN
            RAND (hash (ltk UE HN) RAND)) SUPI))
      (send
        (cat RAND
          (cat (hash SQN (hash (ltk UE HN) RAND))
            (hash SQN RAND (ltk UE HN)))
          (hash
            (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND))
              SN RAND (hash (ltk UE HN) RAND)) RAND)))
      (recv
        (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN
          RAND (hash (ltk UE HN) RAND)))
      (send
        (cat "Success"
          (hash
            (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND))
              SN (hash SQN (hash (ltk UE HN) RAND))) SN) SUPI)))
    (non-orig SQN (ltk UE HN))
    (uniq-gen RAND)))

(defskeleton AKA5G
  (vars (SQN text) (SUPI RAND data) (SN UE HN name))
  (defstrand ServingNetwork 7 (SQN SQN) (SUPI SUPI) (RAND RAND) (UE UE)
    (SN SN) (HN HN))
  (non-orig SQN (ltk UE HN))
  (traces
    ((recv (enc SUPI (pubk HN))) (send (enc SUPI (pubk HN) SN))
      (recv
        (cat RAND
          (cat (hash SQN (hash (ltk UE HN) RAND))
            (hash SQN RAND (ltk UE HN)))
          (hash
            (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND))
              SN RAND (hash (ltk UE HN) RAND)) RAND)))
      (init
        (hash
          (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN
            RAND (hash (ltk UE HN) RAND)) RAND))
      (send
        (cat RAND (hash SQN (hash (ltk UE HN) RAND))
          (hash SQN RAND (ltk UE HN))))
      (recv
        (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN
          RAND (hash (ltk UE HN) RAND)))
      (send
        (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN
          RAND (hash (ltk UE HN) RAND)))))
  (label 3)
  (unrealized (0 2) (0 5))
  (origs)
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton AKA5G
  (vars (SQN text) (SUPI RAND SUPI-0 data) (SN UE HN SN-0 name))
  (defstrand ServingNetwork 7 (SQN SQN) (SUPI SUPI) (RAND RAND) (UE UE)
    (SN SN) (HN HN))
  (defstrand HomeNetwork 3 (SQN SQN) (SUPI SUPI-0) (RAND RAND) (UE UE)
    (SN SN-0) (HN HN))
  (precedes ((1 2) (0 2)))
  (non-orig SQN (ltk UE HN))
  (uniq-gen RAND)
  (operation encryption-test (added-strand HomeNetwork 3)
    (hash SQN (hash (ltk UE HN) RAND)) (0 2))
  (traces
    ((recv (enc SUPI (pubk HN))) (send (enc SUPI (pubk HN) SN))
      (recv
        (cat RAND
          (cat (hash SQN (hash (ltk UE HN) RAND))
            (hash SQN RAND (ltk UE HN)))
          (hash
            (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND))
              SN RAND (hash (ltk UE HN) RAND)) RAND)))
      (init
        (hash
          (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN
            RAND (hash (ltk UE HN) RAND)) RAND))
      (send
        (cat RAND (hash SQN (hash (ltk UE HN) RAND))
          (hash SQN RAND (ltk UE HN))))
      (recv
        (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN
          RAND (hash (ltk UE HN) RAND)))
      (send
        (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN
          RAND (hash (ltk UE HN) RAND))))
    ((recv (enc SUPI-0 (pubk HN) SN-0))
      (init
        (cat
          (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND))
            SN-0 RAND (hash (ltk UE HN) RAND)) SUPI-0))
      (send
        (cat RAND
          (cat (hash SQN (hash (ltk UE HN) RAND))
            (hash SQN RAND (ltk UE HN)))
          (hash
            (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND))
              SN-0 RAND (hash (ltk UE HN) RAND)) RAND)))))
  (label 4)
  (parent 3)
  (unrealized (0 2) (0 5))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton AKA5G
  (vars (SQN text) (SUPI RAND SUPI-0 data) (UE HN SN name))
  (defstrand ServingNetwork 7 (SQN SQN) (SUPI SUPI) (RAND RAND) (UE UE)
    (SN SN) (HN HN))
  (defstrand HomeNetwork 3 (SQN SQN) (SUPI SUPI-0) (RAND RAND) (UE UE)
    (SN SN) (HN HN))
  (precedes ((1 2) (0 2)))
  (non-orig SQN (ltk UE HN))
  (uniq-gen RAND)
  (operation encryption-test (displaced 2 1 HomeNetwork 3)
    (hash
      (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN-0
        RAND (hash (ltk UE HN) RAND)) RAND) (0 2))
  (traces
    ((recv (enc SUPI (pubk HN))) (send (enc SUPI (pubk HN) SN))
      (recv
        (cat RAND
          (cat (hash SQN (hash (ltk UE HN) RAND))
            (hash SQN RAND (ltk UE HN)))
          (hash
            (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND))
              SN RAND (hash (ltk UE HN) RAND)) RAND)))
      (init
        (hash
          (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN
            RAND (hash (ltk UE HN) RAND)) RAND))
      (send
        (cat RAND (hash SQN (hash (ltk UE HN) RAND))
          (hash SQN RAND (ltk UE HN))))
      (recv
        (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN
          RAND (hash (ltk UE HN) RAND)))
      (send
        (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN
          RAND (hash (ltk UE HN) RAND))))
    ((recv (enc SUPI-0 (pubk HN) SN))
      (init
        (cat
          (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN
            RAND (hash (ltk UE HN) RAND)) SUPI-0))
      (send
        (cat RAND
          (cat (hash SQN (hash (ltk UE HN) RAND))
            (hash SQN RAND (ltk UE HN)))
          (hash
            (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND))
              SN RAND (hash (ltk UE HN) RAND)) RAND)))))
  (label 5)
  (parent 4)
  (unrealized (0 5))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton AKA5G
  (vars (SQN text) (SUPI RAND SUPI-0 data) (SN UE HN SN-0 name))
  (defstrand ServingNetwork 7 (SQN SQN) (SUPI SUPI) (RAND RAND) (UE UE)
    (SN SN) (HN HN))
  (defstrand HomeNetwork 3 (SQN SQN) (SUPI SUPI-0) (RAND RAND) (UE UE)
    (SN SN-0) (HN HN))
  (deflistener
    (cat
      (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN
        RAND (hash (ltk UE HN) RAND)) RAND))
  (precedes ((1 1) (2 0)) ((1 2) (0 2)) ((2 1) (0 2)))
  (non-orig SQN (ltk UE HN))
  (uniq-gen RAND)
  (operation encryption-test
    (added-listener
      (cat
        (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN
          RAND (hash (ltk UE HN) RAND)) RAND))
    (hash
      (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN
        RAND (hash (ltk UE HN) RAND)) RAND) (0 2))
  (traces
    ((recv (enc SUPI (pubk HN))) (send (enc SUPI (pubk HN) SN))
      (recv
        (cat RAND
          (cat (hash SQN (hash (ltk UE HN) RAND))
            (hash SQN RAND (ltk UE HN)))
          (hash
            (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND))
              SN RAND (hash (ltk UE HN) RAND)) RAND)))
      (init
        (hash
          (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN
            RAND (hash (ltk UE HN) RAND)) RAND))
      (send
        (cat RAND (hash SQN (hash (ltk UE HN) RAND))
          (hash SQN RAND (ltk UE HN))))
      (recv
        (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN
          RAND (hash (ltk UE HN) RAND)))
      (send
        (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN
          RAND (hash (ltk UE HN) RAND))))
    ((recv (enc SUPI-0 (pubk HN) SN-0))
      (init
        (cat
          (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND))
            SN-0 RAND (hash (ltk UE HN) RAND)) SUPI-0))
      (send
        (cat RAND
          (cat (hash SQN (hash (ltk UE HN) RAND))
            (hash SQN RAND (ltk UE HN)))
          (hash
            (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND))
              SN-0 RAND (hash (ltk UE HN) RAND)) RAND))))
    ((recv
       (cat
         (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN
           RAND (hash (ltk UE HN) RAND)) RAND))
      (send
        (cat
          (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN
            RAND (hash (ltk UE HN) RAND)) RAND))))
  (label 6)
  (parent 4)
  (unrealized (2 0))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton AKA5G
  (vars (SQN SQN-0 text) (SUPI RAND SUPI-0 SUPI-1 data) (UE HN SN name))
  (defstrand ServingNetwork 7 (SQN SQN) (SUPI SUPI) (RAND RAND) (UE UE)
    (SN SN) (HN HN))
  (defstrand HomeNetwork 3 (SQN SQN) (SUPI SUPI-0) (RAND RAND) (UE UE)
    (SN SN) (HN HN))
  (defstrand UserEquip 3 (SQN SQN-0) (SUPI SUPI-1) (RAND RAND) (UE UE)
    (SN SN) (HN HN))
  (precedes ((1 1) (2 1)) ((1 2) (0 2)) ((2 2) (0 5)))
  (non-orig SQN (ltk UE HN))
  (uniq-gen RAND)
  (operation encryption-test (added-strand UserEquip 3)
    (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN RAND
      (hash (ltk UE HN) RAND)) (0 5))
  (traces
    ((recv (enc SUPI (pubk HN))) (send (enc SUPI (pubk HN) SN))
      (recv
        (cat RAND
          (cat (hash SQN (hash (ltk UE HN) RAND))
            (hash SQN RAND (ltk UE HN)))
          (hash
            (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND))
              SN RAND (hash (ltk UE HN) RAND)) RAND)))
      (init
        (hash
          (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN
            RAND (hash (ltk UE HN) RAND)) RAND))
      (send
        (cat RAND (hash SQN (hash (ltk UE HN) RAND))
          (hash SQN RAND (ltk UE HN))))
      (recv
        (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN
          RAND (hash (ltk UE HN) RAND)))
      (send
        (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN
          RAND (hash (ltk UE HN) RAND))))
    ((recv (enc SUPI-0 (pubk HN) SN))
      (init
        (cat
          (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN
            RAND (hash (ltk UE HN) RAND)) SUPI-0))
      (send
        (cat RAND
          (cat (hash SQN (hash (ltk UE HN) RAND))
            (hash SQN RAND (ltk UE HN)))
          (hash
            (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND))
              SN RAND (hash (ltk UE HN) RAND)) RAND))))
    ((send (enc SUPI-1 (pubk HN)))
      (recv
        (cat RAND (hash SQN-0 (hash (ltk UE HN) RAND))
          (hash SQN-0 RAND (ltk UE HN))))
      (send
        (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN
          RAND (hash (ltk UE HN) RAND)))))
  (label 7)
  (parent 5)
  (unrealized (2 1))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton AKA5G
  (vars (SQN text) (SUPI RAND SUPI-0 data) (UE HN SN name))
  (defstrand ServingNetwork 7 (SQN SQN) (SUPI SUPI) (RAND RAND) (UE UE)
    (SN SN) (HN HN))
  (defstrand HomeNetwork 3 (SQN SQN) (SUPI SUPI-0) (RAND RAND) (UE UE)
    (SN SN) (HN HN))
  (deflistener
    (cat (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN RAND
      (hash (ltk UE HN) RAND)))
  (precedes ((1 1) (2 0)) ((1 2) (0 2)) ((2 1) (0 5)))
  (non-orig SQN (ltk UE HN))
  (uniq-gen RAND)
  (operation encryption-test
    (added-listener
      (cat (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN RAND
        (hash (ltk UE HN) RAND)))
    (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN RAND
      (hash (ltk UE HN) RAND)) (0 5))
  (traces
    ((recv (enc SUPI (pubk HN))) (send (enc SUPI (pubk HN) SN))
      (recv
        (cat RAND
          (cat (hash SQN (hash (ltk UE HN) RAND))
            (hash SQN RAND (ltk UE HN)))
          (hash
            (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND))
              SN RAND (hash (ltk UE HN) RAND)) RAND)))
      (init
        (hash
          (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN
            RAND (hash (ltk UE HN) RAND)) RAND))
      (send
        (cat RAND (hash SQN (hash (ltk UE HN) RAND))
          (hash SQN RAND (ltk UE HN))))
      (recv
        (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN
          RAND (hash (ltk UE HN) RAND)))
      (send
        (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN
          RAND (hash (ltk UE HN) RAND))))
    ((recv (enc SUPI-0 (pubk HN) SN))
      (init
        (cat
          (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN
            RAND (hash (ltk UE HN) RAND)) SUPI-0))
      (send
        (cat RAND
          (cat (hash SQN (hash (ltk UE HN) RAND))
            (hash SQN RAND (ltk UE HN)))
          (hash
            (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND))
              SN RAND (hash (ltk UE HN) RAND)) RAND))))
    ((recv
       (cat (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN
         RAND (hash (ltk UE HN) RAND)))
      (send
        (cat (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN
          RAND (hash (ltk UE HN) RAND)))))
  (label 8)
  (parent 5)
  (unrealized (2 0))
  (dead)
  (comment "empty cohort"))

(defskeleton AKA5G
  (vars (SQN SQN-0 text) (SUPI RAND SUPI-0 SUPI-1 data)
    (SN UE HN SN-0 name))
  (defstrand ServingNetwork 7 (SQN SQN) (SUPI SUPI) (RAND RAND) (UE UE)
    (SN SN) (HN HN))
  (defstrand HomeNetwork 3 (SQN SQN) (SUPI SUPI-0) (RAND RAND) (UE UE)
    (SN SN-0) (HN HN))
  (deflistener
    (cat
      (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN
        RAND (hash (ltk UE HN) RAND)) RAND))
  (defstrand UserEquip 3 (SQN SQN-0) (SUPI SUPI-1) (RAND RAND) (UE UE)
    (SN SN) (HN HN))
  (precedes ((1 1) (3 1)) ((1 2) (0 2)) ((2 1) (0 2)) ((3 2) (2 0)))
  (non-orig SQN (ltk UE HN))
  (uniq-gen RAND)
  (operation encryption-test (added-strand UserEquip 3)
    (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN RAND
      (hash (ltk UE HN) RAND)) (2 0))
  (traces
    ((recv (enc SUPI (pubk HN))) (send (enc SUPI (pubk HN) SN))
      (recv
        (cat RAND
          (cat (hash SQN (hash (ltk UE HN) RAND))
            (hash SQN RAND (ltk UE HN)))
          (hash
            (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND))
              SN RAND (hash (ltk UE HN) RAND)) RAND)))
      (init
        (hash
          (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN
            RAND (hash (ltk UE HN) RAND)) RAND))
      (send
        (cat RAND (hash SQN (hash (ltk UE HN) RAND))
          (hash SQN RAND (ltk UE HN))))
      (recv
        (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN
          RAND (hash (ltk UE HN) RAND)))
      (send
        (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN
          RAND (hash (ltk UE HN) RAND))))
    ((recv (enc SUPI-0 (pubk HN) SN-0))
      (init
        (cat
          (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND))
            SN-0 RAND (hash (ltk UE HN) RAND)) SUPI-0))
      (send
        (cat RAND
          (cat (hash SQN (hash (ltk UE HN) RAND))
            (hash SQN RAND (ltk UE HN)))
          (hash
            (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND))
              SN-0 RAND (hash (ltk UE HN) RAND)) RAND))))
    ((recv
       (cat
         (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN
           RAND (hash (ltk UE HN) RAND)) RAND))
      (send
        (cat
          (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN
            RAND (hash (ltk UE HN) RAND)) RAND)))
    ((send (enc SUPI-1 (pubk HN)))
      (recv
        (cat RAND (hash SQN-0 (hash (ltk UE HN) RAND))
          (hash SQN-0 RAND (ltk UE HN))))
      (send
        (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN
          RAND (hash (ltk UE HN) RAND)))))
  (label 9)
  (parent 6)
  (unrealized (2 0) (3 1))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton AKA5G
  (vars (SQN text) (SUPI RAND SUPI-0 data) (SN UE HN SN-0 name))
  (defstrand ServingNetwork 7 (SQN SQN) (SUPI SUPI) (RAND RAND) (UE UE)
    (SN SN) (HN HN))
  (defstrand HomeNetwork 3 (SQN SQN) (SUPI SUPI-0) (RAND RAND) (UE UE)
    (SN SN-0) (HN HN))
  (deflistener
    (cat
      (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN
        RAND (hash (ltk UE HN) RAND)) RAND))
  (deflistener
    (cat (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN RAND
      (hash (ltk UE HN) RAND)))
  (precedes ((1 1) (3 0)) ((1 2) (0 2)) ((2 1) (0 2)) ((3 1) (2 0)))
  (non-orig SQN (ltk UE HN))
  (uniq-gen RAND)
  (operation encryption-test
    (added-listener
      (cat (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN RAND
        (hash (ltk UE HN) RAND)))
    (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN RAND
      (hash (ltk UE HN) RAND)) (2 0))
  (traces
    ((recv (enc SUPI (pubk HN))) (send (enc SUPI (pubk HN) SN))
      (recv
        (cat RAND
          (cat (hash SQN (hash (ltk UE HN) RAND))
            (hash SQN RAND (ltk UE HN)))
          (hash
            (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND))
              SN RAND (hash (ltk UE HN) RAND)) RAND)))
      (init
        (hash
          (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN
            RAND (hash (ltk UE HN) RAND)) RAND))
      (send
        (cat RAND (hash SQN (hash (ltk UE HN) RAND))
          (hash SQN RAND (ltk UE HN))))
      (recv
        (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN
          RAND (hash (ltk UE HN) RAND)))
      (send
        (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN
          RAND (hash (ltk UE HN) RAND))))
    ((recv (enc SUPI-0 (pubk HN) SN-0))
      (init
        (cat
          (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND))
            SN-0 RAND (hash (ltk UE HN) RAND)) SUPI-0))
      (send
        (cat RAND
          (cat (hash SQN (hash (ltk UE HN) RAND))
            (hash SQN RAND (ltk UE HN)))
          (hash
            (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND))
              SN-0 RAND (hash (ltk UE HN) RAND)) RAND))))
    ((recv
       (cat
         (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN
           RAND (hash (ltk UE HN) RAND)) RAND))
      (send
        (cat
          (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN
            RAND (hash (ltk UE HN) RAND)) RAND)))
    ((recv
       (cat (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN
         RAND (hash (ltk UE HN) RAND)))
      (send
        (cat (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN
          RAND (hash (ltk UE HN) RAND)))))
  (label 10)
  (parent 6)
  (unrealized (3 0))
  (dead)
  (comment "empty cohort"))

(defskeleton AKA5G
  (vars (SQN text) (SUPI RAND SUPI-0 SUPI-1 data) (UE HN SN name))
  (defstrand ServingNetwork 7 (SQN SQN) (SUPI SUPI) (RAND RAND) (UE UE)
    (SN SN) (HN HN))
  (defstrand HomeNetwork 3 (SQN SQN) (SUPI SUPI-0) (RAND RAND) (UE UE)
    (SN SN) (HN HN))
  (defstrand UserEquip 3 (SQN SQN) (SUPI SUPI-1) (RAND RAND) (UE UE)
    (SN SN) (HN HN))
  (precedes ((1 2) (0 2)) ((1 2) (2 1)) ((2 2) (0 5)))
  (non-orig SQN (ltk UE HN))
  (uniq-gen RAND)
  (operation encryption-test (displaced 3 1 HomeNetwork 3)
    (hash SQN-0 (hash (ltk UE HN) RAND)) (2 1))
  (traces
    ((recv (enc SUPI (pubk HN))) (send (enc SUPI (pubk HN) SN))
      (recv
        (cat RAND
          (cat (hash SQN (hash (ltk UE HN) RAND))
            (hash SQN RAND (ltk UE HN)))
          (hash
            (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND))
              SN RAND (hash (ltk UE HN) RAND)) RAND)))
      (init
        (hash
          (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN
            RAND (hash (ltk UE HN) RAND)) RAND))
      (send
        (cat RAND (hash SQN (hash (ltk UE HN) RAND))
          (hash SQN RAND (ltk UE HN))))
      (recv
        (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN
          RAND (hash (ltk UE HN) RAND)))
      (send
        (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN
          RAND (hash (ltk UE HN) RAND))))
    ((recv (enc SUPI-0 (pubk HN) SN))
      (init
        (cat
          (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN
            RAND (hash (ltk UE HN) RAND)) SUPI-0))
      (send
        (cat RAND
          (cat (hash SQN (hash (ltk UE HN) RAND))
            (hash SQN RAND (ltk UE HN)))
          (hash
            (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND))
              SN RAND (hash (ltk UE HN) RAND)) RAND))))
    ((send (enc SUPI-1 (pubk HN)))
      (recv
        (cat RAND (hash SQN (hash (ltk UE HN) RAND))
          (hash SQN RAND (ltk UE HN))))
      (send
        (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN
          RAND (hash (ltk UE HN) RAND)))))
  (label 11)
  (parent 7)
  (unrealized)
  (shape)
  (maps
    ((0) ((SN SN) (SUPI SUPI) (RAND RAND) (UE UE) (HN HN) (SQN SQN))))
  (origs))

(defskeleton AKA5G
  (vars (SQN SQN-0 text) (SUPI RAND SUPI-0 SUPI-1 data) (UE HN SN name))
  (defstrand ServingNetwork 7 (SQN SQN) (SUPI SUPI) (RAND RAND) (UE UE)
    (SN SN) (HN HN))
  (defstrand HomeNetwork 3 (SQN SQN) (SUPI SUPI-0) (RAND RAND) (UE UE)
    (SN SN) (HN HN))
  (defstrand UserEquip 3 (SQN SQN-0) (SUPI SUPI-1) (RAND RAND) (UE UE)
    (SN SN) (HN HN))
  (deflistener (cat SQN-0 (hash (ltk UE HN) RAND)))
  (precedes ((1 1) (3 0)) ((1 2) (0 2)) ((2 2) (0 5)) ((3 1) (2 1)))
  (non-orig SQN (ltk UE HN))
  (uniq-gen RAND)
  (operation encryption-test
    (added-listener (cat SQN-0 (hash (ltk UE HN) RAND)))
    (hash SQN-0 (hash (ltk UE HN) RAND)) (2 1))
  (traces
    ((recv (enc SUPI (pubk HN))) (send (enc SUPI (pubk HN) SN))
      (recv
        (cat RAND
          (cat (hash SQN (hash (ltk UE HN) RAND))
            (hash SQN RAND (ltk UE HN)))
          (hash
            (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND))
              SN RAND (hash (ltk UE HN) RAND)) RAND)))
      (init
        (hash
          (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN
            RAND (hash (ltk UE HN) RAND)) RAND))
      (send
        (cat RAND (hash SQN (hash (ltk UE HN) RAND))
          (hash SQN RAND (ltk UE HN))))
      (recv
        (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN
          RAND (hash (ltk UE HN) RAND)))
      (send
        (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN
          RAND (hash (ltk UE HN) RAND))))
    ((recv (enc SUPI-0 (pubk HN) SN))
      (init
        (cat
          (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN
            RAND (hash (ltk UE HN) RAND)) SUPI-0))
      (send
        (cat RAND
          (cat (hash SQN (hash (ltk UE HN) RAND))
            (hash SQN RAND (ltk UE HN)))
          (hash
            (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND))
              SN RAND (hash (ltk UE HN) RAND)) RAND))))
    ((send (enc SUPI-1 (pubk HN)))
      (recv
        (cat RAND (hash SQN-0 (hash (ltk UE HN) RAND))
          (hash SQN-0 RAND (ltk UE HN))))
      (send
        (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN
          RAND (hash (ltk UE HN) RAND))))
    ((recv (cat SQN-0 (hash (ltk UE HN) RAND)))
      (send (cat SQN-0 (hash (ltk UE HN) RAND)))))
  (label 12)
  (parent 7)
  (unrealized (2 1) (3 0))
  (dead)
  (comment "empty cohort"))

(defskeleton AKA5G
  (vars (SQN text) (SUPI RAND SUPI-0 SUPI-1 data) (SN UE HN SN-0 name))
  (defstrand ServingNetwork 7 (SQN SQN) (SUPI SUPI) (RAND RAND) (UE UE)
    (SN SN) (HN HN))
  (defstrand HomeNetwork 3 (SQN SQN) (SUPI SUPI-0) (RAND RAND) (UE UE)
    (SN SN-0) (HN HN))
  (deflistener
    (cat
      (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN
        RAND (hash (ltk UE HN) RAND)) RAND))
  (defstrand UserEquip 3 (SQN SQN) (SUPI SUPI-1) (RAND RAND) (UE UE)
    (SN SN) (HN HN))
  (precedes ((1 2) (3 1)) ((2 1) (0 2)) ((3 2) (2 0)))
  (non-orig SQN (ltk UE HN))
  (uniq-gen RAND)
  (operation encryption-test (displaced 4 1 HomeNetwork 3)
    (hash SQN-0 (hash (ltk UE HN) RAND)) (3 1))
  (traces
    ((recv (enc SUPI (pubk HN))) (send (enc SUPI (pubk HN) SN))
      (recv
        (cat RAND
          (cat (hash SQN (hash (ltk UE HN) RAND))
            (hash SQN RAND (ltk UE HN)))
          (hash
            (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND))
              SN RAND (hash (ltk UE HN) RAND)) RAND)))
      (init
        (hash
          (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN
            RAND (hash (ltk UE HN) RAND)) RAND))
      (send
        (cat RAND (hash SQN (hash (ltk UE HN) RAND))
          (hash SQN RAND (ltk UE HN))))
      (recv
        (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN
          RAND (hash (ltk UE HN) RAND)))
      (send
        (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN
          RAND (hash (ltk UE HN) RAND))))
    ((recv (enc SUPI-0 (pubk HN) SN-0))
      (init
        (cat
          (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND))
            SN-0 RAND (hash (ltk UE HN) RAND)) SUPI-0))
      (send
        (cat RAND
          (cat (hash SQN (hash (ltk UE HN) RAND))
            (hash SQN RAND (ltk UE HN)))
          (hash
            (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND))
              SN-0 RAND (hash (ltk UE HN) RAND)) RAND))))
    ((recv
       (cat
         (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN
           RAND (hash (ltk UE HN) RAND)) RAND))
      (send
        (cat
          (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN
            RAND (hash (ltk UE HN) RAND)) RAND)))
    ((send (enc SUPI-1 (pubk HN)))
      (recv
        (cat RAND (hash SQN (hash (ltk UE HN) RAND))
          (hash SQN RAND (ltk UE HN))))
      (send
        (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN
          RAND (hash (ltk UE HN) RAND)))))
  (label 13)
  (parent 9)
  (unrealized)
  (comment "1 in cohort - 1 not yet seen"))

(defskeleton AKA5G
  (vars (SQN SQN-0 text) (SUPI RAND SUPI-0 SUPI-1 data)
    (SN UE HN SN-0 name))
  (defstrand ServingNetwork 7 (SQN SQN) (SUPI SUPI) (RAND RAND) (UE UE)
    (SN SN) (HN HN))
  (defstrand HomeNetwork 3 (SQN SQN) (SUPI SUPI-0) (RAND RAND) (UE UE)
    (SN SN-0) (HN HN))
  (deflistener
    (cat
      (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN
        RAND (hash (ltk UE HN) RAND)) RAND))
  (defstrand UserEquip 3 (SQN SQN-0) (SUPI SUPI-1) (RAND RAND) (UE UE)
    (SN SN) (HN HN))
  (deflistener (cat SQN-0 (hash (ltk UE HN) RAND)))
  (precedes ((1 1) (4 0)) ((1 2) (0 2)) ((2 1) (0 2)) ((3 2) (2 0))
    ((4 1) (3 1)))
  (non-orig SQN (ltk UE HN))
  (uniq-gen RAND)
  (operation encryption-test
    (added-listener (cat SQN-0 (hash (ltk UE HN) RAND)))
    (hash SQN-0 (hash (ltk UE HN) RAND)) (3 1))
  (traces
    ((recv (enc SUPI (pubk HN))) (send (enc SUPI (pubk HN) SN))
      (recv
        (cat RAND
          (cat (hash SQN (hash (ltk UE HN) RAND))
            (hash SQN RAND (ltk UE HN)))
          (hash
            (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND))
              SN RAND (hash (ltk UE HN) RAND)) RAND)))
      (init
        (hash
          (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN
            RAND (hash (ltk UE HN) RAND)) RAND))
      (send
        (cat RAND (hash SQN (hash (ltk UE HN) RAND))
          (hash SQN RAND (ltk UE HN))))
      (recv
        (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN
          RAND (hash (ltk UE HN) RAND)))
      (send
        (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN
          RAND (hash (ltk UE HN) RAND))))
    ((recv (enc SUPI-0 (pubk HN) SN-0))
      (init
        (cat
          (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND))
            SN-0 RAND (hash (ltk UE HN) RAND)) SUPI-0))
      (send
        (cat RAND
          (cat (hash SQN (hash (ltk UE HN) RAND))
            (hash SQN RAND (ltk UE HN)))
          (hash
            (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND))
              SN-0 RAND (hash (ltk UE HN) RAND)) RAND))))
    ((recv
       (cat
         (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN
           RAND (hash (ltk UE HN) RAND)) RAND))
      (send
        (cat
          (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN
            RAND (hash (ltk UE HN) RAND)) RAND)))
    ((send (enc SUPI-1 (pubk HN)))
      (recv
        (cat RAND (hash SQN-0 (hash (ltk UE HN) RAND))
          (hash SQN-0 RAND (ltk UE HN))))
      (send
        (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN
          RAND (hash (ltk UE HN) RAND))))
    ((recv (cat SQN-0 (hash (ltk UE HN) RAND)))
      (send (cat SQN-0 (hash (ltk UE HN) RAND)))))
  (label 14)
  (parent 9)
  (unrealized (2 0) (3 1) (4 0))
  (dead)
  (comment "empty cohort"))

(defskeleton AKA5G
  (vars (SQN text) (SUPI RAND SUPI-0 SUPI-1 data) (SN UE HN SN-0 name))
  (defstrand ServingNetwork 7 (SQN SQN) (SUPI SUPI) (RAND RAND) (UE UE)
    (SN SN) (HN HN))
  (defstrand HomeNetwork 3 (SQN SQN) (SUPI SUPI-0) (RAND RAND) (UE UE)
    (SN SN-0) (HN HN))
  (defstrand UserEquip 3 (SQN SQN) (SUPI SUPI-1) (RAND RAND) (UE UE)
    (SN SN) (HN HN))
  (precedes ((1 2) (2 1)) ((2 2) (0 2)))
  (non-orig SQN (ltk UE HN))
  (uniq-gen RAND)
  (operation generalization deleted (2 0))
  (traces
    ((recv (enc SUPI (pubk HN))) (send (enc SUPI (pubk HN) SN))
      (recv
        (cat RAND
          (cat (hash SQN (hash (ltk UE HN) RAND))
            (hash SQN RAND (ltk UE HN)))
          (hash
            (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND))
              SN RAND (hash (ltk UE HN) RAND)) RAND)))
      (init
        (hash
          (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN
            RAND (hash (ltk UE HN) RAND)) RAND))
      (send
        (cat RAND (hash SQN (hash (ltk UE HN) RAND))
          (hash SQN RAND (ltk UE HN))))
      (recv
        (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN
          RAND (hash (ltk UE HN) RAND)))
      (send
        (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN
          RAND (hash (ltk UE HN) RAND))))
    ((recv (enc SUPI-0 (pubk HN) SN-0))
      (init
        (cat
          (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND))
            SN-0 RAND (hash (ltk UE HN) RAND)) SUPI-0))
      (send
        (cat RAND
          (cat (hash SQN (hash (ltk UE HN) RAND))
            (hash SQN RAND (ltk UE HN)))
          (hash
            (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND))
              SN-0 RAND (hash (ltk UE HN) RAND)) RAND))))
    ((send (enc SUPI-1 (pubk HN)))
      (recv
        (cat RAND (hash SQN (hash (ltk UE HN) RAND))
          (hash SQN RAND (ltk UE HN))))
      (send
        (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN
          RAND (hash (ltk UE HN) RAND)))))
  (label 15)
  (parent 13)
  (unrealized)
  (shape)
  (maps
    ((0) ((SN SN) (SUPI SUPI) (RAND RAND) (UE UE) (HN HN) (SQN SQN))))
  (origs))

(comment "Nothing left to do")

(defprotocol AKA5G basic
  (defrole UserEquip
    (vars (SUPI RAND data) (UE SN HN name) (SQN text))
    (trace (send (enc SUPI (pubk HN)))
      (recv
        (cat RAND (hash SQN (hash (ltk UE HN) RAND))
          (hash SQN RAND (ltk UE HN))))
      (send
        (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN
          RAND (hash (ltk UE HN) RAND))))
    (non-orig (ltk UE HN)))
  (defrole ServingNetwork
    (vars (SUPI RAND data) (UE SN HN name) (SQN text))
    (trace (recv (enc SUPI (pubk HN))) (send (enc SUPI (pubk HN) SN))
      (recv
        (cat RAND
          (cat (hash SQN (hash (ltk UE HN) RAND))
            (hash SQN RAND (ltk UE HN)))
          (hash
            (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND))
              SN RAND (hash (ltk UE HN) RAND)) RAND)))
      (init
        (hash
          (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN
            RAND (hash (ltk UE HN) RAND)) RAND))
      (send
        (cat RAND (hash SQN (hash (ltk UE HN) RAND))
          (hash SQN RAND (ltk UE HN))))
      (recv
        (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN
          RAND (hash (ltk UE HN) RAND)))
      (send
        (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN
          RAND (hash (ltk UE HN) RAND)))
      (recv
        (cat "Success"
          (hash
            (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND))
              SN (hash SQN (hash (ltk UE HN) RAND))) SN) SUPI)))
    (non-orig SQN (ltk UE HN)))
  (defrole HomeNetwork
    (vars (SUPI RAND data) (UE SN HN name) (SQN text))
    (trace (recv (enc SUPI (pubk HN) SN))
      (init
        (cat
          (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN
            RAND (hash (ltk UE HN) RAND)) SUPI))
      (send
        (cat RAND
          (cat (hash SQN (hash (ltk UE HN) RAND))
            (hash SQN RAND (ltk UE HN)))
          (hash
            (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND))
              SN RAND (hash (ltk UE HN) RAND)) RAND)))
      (recv
        (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN
          RAND (hash (ltk UE HN) RAND)))
      (send
        (cat "Success"
          (hash
            (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND))
              SN (hash SQN (hash (ltk UE HN) RAND))) SN) SUPI)))
    (non-orig SQN (ltk UE HN))
    (uniq-gen RAND)))

(defskeleton AKA5G
  (vars (SQN text) (SUPI RAND data) (UE HN SN name))
  (defstrand HomeNetwork 4 (SQN SQN) (SUPI SUPI) (RAND RAND) (UE UE)
    (SN SN) (HN HN))
  (non-orig SQN (ltk UE HN))
  (uniq-gen RAND)
  (traces
    ((recv (enc SUPI (pubk HN) SN))
      (init
        (cat
          (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN
            RAND (hash (ltk UE HN) RAND)) SUPI))
      (send
        (cat RAND
          (cat (hash SQN (hash (ltk UE HN) RAND))
            (hash SQN RAND (ltk UE HN)))
          (hash
            (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND))
              SN RAND (hash (ltk UE HN) RAND)) RAND)))
      (recv
        (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN
          RAND (hash (ltk UE HN) RAND)))))
  (label 16)
  (unrealized (0 3))
  (origs)
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton AKA5G
  (vars (SQN SQN-0 text) (SUPI RAND SUPI-0 data) (UE HN SN name))
  (defstrand HomeNetwork 4 (SQN SQN) (SUPI SUPI) (RAND RAND) (UE UE)
    (SN SN) (HN HN))
  (defstrand UserEquip 3 (SQN SQN-0) (SUPI SUPI-0) (RAND RAND) (UE UE)
    (SN SN) (HN HN))
  (precedes ((0 1) (1 1)) ((1 2) (0 3)))
  (non-orig SQN (ltk UE HN))
  (uniq-gen RAND)
  (operation encryption-test (added-strand UserEquip 3)
    (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN RAND
      (hash (ltk UE HN) RAND)) (0 3))
  (traces
    ((recv (enc SUPI (pubk HN) SN))
      (init
        (cat
          (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN
            RAND (hash (ltk UE HN) RAND)) SUPI))
      (send
        (cat RAND
          (cat (hash SQN (hash (ltk UE HN) RAND))
            (hash SQN RAND (ltk UE HN)))
          (hash
            (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND))
              SN RAND (hash (ltk UE HN) RAND)) RAND)))
      (recv
        (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN
          RAND (hash (ltk UE HN) RAND))))
    ((send (enc SUPI-0 (pubk HN)))
      (recv
        (cat RAND (hash SQN-0 (hash (ltk UE HN) RAND))
          (hash SQN-0 RAND (ltk UE HN))))
      (send
        (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN
          RAND (hash (ltk UE HN) RAND)))))
  (label 17)
  (parent 16)
  (unrealized (1 1))
  (comment "2 in cohort - 2 not yet seen"))

(defskeleton AKA5G
  (vars (SQN text) (SUPI RAND data) (UE HN SN name))
  (defstrand HomeNetwork 4 (SQN SQN) (SUPI SUPI) (RAND RAND) (UE UE)
    (SN SN) (HN HN))
  (deflistener
    (cat (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN RAND
      (hash (ltk UE HN) RAND)))
  (precedes ((0 1) (1 0)) ((1 1) (0 3)))
  (non-orig SQN (ltk UE HN))
  (uniq-gen RAND)
  (operation encryption-test
    (added-listener
      (cat (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN RAND
        (hash (ltk UE HN) RAND)))
    (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN RAND
      (hash (ltk UE HN) RAND)) (0 3))
  (traces
    ((recv (enc SUPI (pubk HN) SN))
      (init
        (cat
          (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN
            RAND (hash (ltk UE HN) RAND)) SUPI))
      (send
        (cat RAND
          (cat (hash SQN (hash (ltk UE HN) RAND))
            (hash SQN RAND (ltk UE HN)))
          (hash
            (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND))
              SN RAND (hash (ltk UE HN) RAND)) RAND)))
      (recv
        (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN
          RAND (hash (ltk UE HN) RAND))))
    ((recv
       (cat (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN
         RAND (hash (ltk UE HN) RAND)))
      (send
        (cat (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN
          RAND (hash (ltk UE HN) RAND)))))
  (label 18)
  (parent 16)
  (unrealized (1 0))
  (dead)
  (comment "empty cohort"))

(defskeleton AKA5G
  (vars (SQN text) (SUPI RAND SUPI-0 data) (UE HN SN name))
  (defstrand HomeNetwork 4 (SQN SQN) (SUPI SUPI) (RAND RAND) (UE UE)
    (SN SN) (HN HN))
  (defstrand UserEquip 3 (SQN SQN) (SUPI SUPI-0) (RAND RAND) (UE UE)
    (SN SN) (HN HN))
  (precedes ((0 2) (1 1)) ((1 2) (0 3)))
  (non-orig SQN (ltk UE HN))
  (uniq-gen RAND)
  (operation encryption-test (displaced 2 0 HomeNetwork 3)
    (hash SQN-0 (hash (ltk UE HN) RAND)) (1 1))
  (traces
    ((recv (enc SUPI (pubk HN) SN))
      (init
        (cat
          (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN
            RAND (hash (ltk UE HN) RAND)) SUPI))
      (send
        (cat RAND
          (cat (hash SQN (hash (ltk UE HN) RAND))
            (hash SQN RAND (ltk UE HN)))
          (hash
            (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND))
              SN RAND (hash (ltk UE HN) RAND)) RAND)))
      (recv
        (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN
          RAND (hash (ltk UE HN) RAND))))
    ((send (enc SUPI-0 (pubk HN)))
      (recv
        (cat RAND (hash SQN (hash (ltk UE HN) RAND))
          (hash SQN RAND (ltk UE HN))))
      (send
        (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN
          RAND (hash (ltk UE HN) RAND)))))
  (label 19)
  (parent 17)
  (unrealized)
  (shape)
  (maps
    ((0) ((SUPI SUPI) (RAND RAND) (UE UE) (HN HN) (SN SN) (SQN SQN))))
  (origs))

(defskeleton AKA5G
  (vars (SQN SQN-0 text) (SUPI RAND SUPI-0 data) (UE HN SN name))
  (defstrand HomeNetwork 4 (SQN SQN) (SUPI SUPI) (RAND RAND) (UE UE)
    (SN SN) (HN HN))
  (defstrand UserEquip 3 (SQN SQN-0) (SUPI SUPI-0) (RAND RAND) (UE UE)
    (SN SN) (HN HN))
  (deflistener (cat SQN-0 (hash (ltk UE HN) RAND)))
  (precedes ((0 1) (2 0)) ((1 2) (0 3)) ((2 1) (1 1)))
  (non-orig SQN (ltk UE HN))
  (uniq-gen RAND)
  (operation encryption-test
    (added-listener (cat SQN-0 (hash (ltk UE HN) RAND)))
    (hash SQN-0 (hash (ltk UE HN) RAND)) (1 1))
  (traces
    ((recv (enc SUPI (pubk HN) SN))
      (init
        (cat
          (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN
            RAND (hash (ltk UE HN) RAND)) SUPI))
      (send
        (cat RAND
          (cat (hash SQN (hash (ltk UE HN) RAND))
            (hash SQN RAND (ltk UE HN)))
          (hash
            (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND))
              SN RAND (hash (ltk UE HN) RAND)) RAND)))
      (recv
        (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN
          RAND (hash (ltk UE HN) RAND))))
    ((send (enc SUPI-0 (pubk HN)))
      (recv
        (cat RAND (hash SQN-0 (hash (ltk UE HN) RAND))
          (hash SQN-0 RAND (ltk UE HN))))
      (send
        (hash (cat (hash (ltk UE HN) RAND) (hash (ltk UE HN) RAND)) SN
          RAND (hash (ltk UE HN) RAND))))
    ((recv (cat SQN-0 (hash (ltk UE HN) RAND)))
      (send (cat SQN-0 (hash (ltk UE HN) RAND)))))
  (label 20)
  (parent 17)
  (unrealized (1 1) (2 0))
  (dead)
  (comment "empty cohort"))

(comment "Nothing left to do")
